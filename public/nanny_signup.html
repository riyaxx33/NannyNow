<!DOCTYPE html>
<html lang="en"> 
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous"
    />

    <title>Nanny Sign Up</title>

    <link rel="stylesheet" href="nanny_signup.css" />
  </head>

  <header>
    <a href="display.html">
      <img class="logoo" src="img/logo.png" alt="Nany logo" />
    </a>
    <div class="auth-buttons">
      <a href="login_page.html" class="btn login">Login</a>
    </div>
  </header>

  <body class="background">
    <div id="app" class="container">
      <form @submit.prevent="handleSubmit" class="pt-2">
        <h1>Nanny Signup Form</h1>
        <!--Full name and name-->
        <div class="row">
          <div class="col-6">
            <label for="firstName" class="form-label">First Name</label>
            <input
              type="text"
              class="form-control"
              id="firstName"
              placeholder="First Name"
              v-model="firstName"
              required
            />
          </div>
          <div class="col-6">
            <label for="lastName" class="form-label">Last Name</label>
            <input
              type="text"
              class="form-control"
              id="lastName"
              placeholder="Last Name"
              v-model="lastName"
              required
            />
          </div>
        </div>
        <!-- Email row -->
        <div class="row">
          <div class="col-6">
            <label for="email" class="form-label">Email</label>
            <input
              type="email"
              class="form-control"
              id="email"
              placeholder="Email Address"
              v-model="email"
              required
            />
          </div>
          <div class="col-6">
            <label for="phoneNumber" class="form-label">Phone Number</label>
            <input
              type="text"
              class="form-control"
              id="phoneNumber"
              placeholder="Phone Number"
              v-model="phoneNumber"
              required
            />
          </div>
        </div>
        <!-- Password -->
        <div class="row">
          <div class="col-6">
            <label for="password" class="form-label">Password</label>
            <input
              type="password"
              class="form-control"
              id="password"
              placeholder="Password"
              v-model="password"
              required
              @input="validatePassword"
            />
            <div v-if="passwordError" class="text-danger">
              {{passwordError}}
            </div>
          </div>
          <!-- confirm password -->
          <div class="col-6">
            <label for="confirmPassword" class="form-label">Confirm Password</label>
            <input
              type="password"
              class="form-control"
              id="confirmPassword"
              placeholder="Confirm Password"
              v-model="confirmPassword"
              required
              @input="validatePassword"
            />
            <div v-if="confirmPasswordError" class="text-danger">
              {{ confirmPasswordError }}
            </div>
          </div>
        </div>
        <!-- DOB and Gender  -->
        <div class="row">
          <div class="mt-3 col-6">
            <label for="dob" class="form-label">Date of Birth</label>
            <input
              type="date"
              class="form-control"
              id="dob"
              v-model="dob"
              required
            />
          </div>
          <div class="mt-3 col-6">
            <label for="gender" class="form-label">Gender</label>
            <select class="form-select" id="gender" v-model="gender" required>
              <option value="">Select gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </div>
        </div>
        <!-- yrs of exp and pfp -->
        <div class="row">
          <div class="col-6">
            <label for="yrsExp" class="form-label">Years of Experience</label>
            <input
              type="text"
              class="form-control"
              id="yrsExp"
              placeholder="Years of Experience"
              v-model="yrsExp"
              required
            />
          </div>
          <div class="form-group col-6">
            <label for="profilePicture" class="form-label d-block">Upload Your Profile Picture</label>
            <input
              type="file"
              id="profilePicture"
              v-model="profilePicture"
              @change="handleFileUpload"
              accept="image/*"
              class="form-control-file"
            />
            <small class="text-muted d-block mt-2"
              >Only image files of sizes smaller than 5MB are accepted.</small
            >
          </div>
        </div>
        <!-- description -->
        <div class="col-12">
          <label for="description" class="form-label">Description</label>
          <textarea
            class="form-control"
            id="description"
            placeholder="Introduce yourself and note down any prior experience you would like to share..."
            v-model="description"
            required
            rows="5"
          ></textarea>
        </div>
        <!-- consent -->
        <div class="col-12 mt-3">
        <label for="consent">
          <input type="checkbox" id="consent" name="consent" required>
          I consent to providing my personal details to nany
        </label>
        </div>
      <!-- submit -->
        <div class="row">
          <div class="col-12 mt-4">
            <button type="submit" class="btn btn-primary">Sign Up</button>
          </div>
        </div>

        <p v-if="errorMessage" class="error">{{ errorMessage }}</p>
      </form>
    </div>

    <script type="module">
      import { createApp } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";
      import {
        storeNannyData,
        handleFileUpload,
        redirectToNannyHome,
      } from "./backend/firebase-op.js";
      import { auth } from "./backend/firebase-config.js";
      import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

      const app = createApp({
        data() {
          return {
            email: "",
            firstName: "",
            lastName: "",
            dob: "",
            gender: "",
            homeAddress: "",
            password: "",
            confirmPassword: "",
            passwordError: "",
            confirmPasswordError: "",
            profilePicture: null,
          };
        },
        computed: {
          isFormValid() {
            return (
              this.email &&
              this.firstName &&
              this.lastName &&
              this.dob &&
              this.homeAddress & this.password &&
              this.confirmPassword &&
              !this.passwordError &&
              !this.confirmPasswordError
            );
          },
        },

        methods: {

          validatePassword() {
            // Password must be at least 8 characters long and contain a number
            const passwordRegex = /^(?=.*\d).{8,}$/;

            if (!passwordRegex.test(this.password)) {
              this.passwordError = "Password must be at least 8 characters long and contain a number";
            } else {
              this.passwordError = "";
            }

            if (this.password !== this.confirmPassword) {
              this.confirmPasswordError = "Passwords do not match";
            } else {
              this.confirmPasswordError = "";
            }
          },

          handleProfilePictureUpload(event) {
            const file = handleFileUpload(event);
            if (file) {
              this.profilePicture = file;
            } else {
              this.profilePicture = null;
            }
          },

          async handleSubmit() {
            if (!this.isFormValid) {
              console.log("Form is not valid");
              this.errorMessage = "Please fill in all required fields.";
              return;
            }

            try {
              const userCredential = await createUserWithEmailAndPassword(
                auth,
                this.email,
                this.password
              );
              const user = userCredential.user;

              await storeNannyData(user, {
                email: this.email,
                firstName: this.firstName,
                lastName: this.lastName,
                dob: this.dob,
                gender: this.gender,
                homeAddress: this.homeAddress,
                profilePicture: this.profilePicture,
              });

              console.log("User registered successfully");
              redirectToNannyHome();
            } catch (error) {
              console.log("Error in signup process:", error);
              this.errorMessage = error.message;
            }
          },
        },
      });

      app.mount("#app");
    </script>

    <!-- Bundled Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
