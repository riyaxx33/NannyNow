<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nanny Home - Parent Posts</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      #jobSearch::placeholder {
        font-family: "Poppins", sans-serif;
      }
      #detailsContainer {
        position: sticky;
        top: 60px;
        background-color: white;
        border-left: 1px solid #ccc;
        border: 2px solid #ddd;
        border-radius: 5px;
        padding: 20px;
        height: calc(100vh - 60px);
        overflow-y: hidden;
        font-family: "Poppins", sans-serif;
      }

      #jobDescriptionContainer {
        height: calc(100% - 70px);
        overflow-y: auto;
        padding: 10px;
        border: 1px solid #ddd;
        margin-top: 15px;
      }

      .job-card {
        cursor: pointer;
        margin-bottom: 10px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.3s ease;
        height: auto;
      }

      .job-card:hover {
        background-color: #f8f9fa;
      }

      .job-card img {
        width: 80px;
        height: 80px;
        margin-right: 15px;
        border-radius: 50%;
        object-fit: cover;
      }

      .job-card-content img {
        position: relative;
        top: -25px;
      }

      .job-card-content {
        display: flex;
        align-items: center;
        width: 100%;
        font-family: "Poppins", sans-serif;
      }

      .job-card-content p {
        font-size: 15px;
      }

      .job-description {
        flex-grow: 1;
      }

      .search-container {
        position: relative;
        padding: 10px;
        margin: 0px;
      }

      .search-bar {
        display: flex;
        gap: 15px;
        align-items: center;
        font-family: "Poppins", sans-serif;
      }

      .search-input-group {
        flex-grow: 1;
        position: relative;
      }

      .filter-dropdown {
        position: relative;
        min-width: 200px;
        font-family: "Poppins", sans-serif;
      }

      .filter-button {
        width: 100%;
        height: 45px;
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 0 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: #495057;
        font-weight: 500;
        transition: all 0.2s ease;
        cursor: pointer;
      }

      .filter-button:hover {
        border-color: #adb5bd;
        background-color: #f8f9fa;
      }

      .filter-menu {
        position: absolute;
        top: calc(100% + 5px);
        left: 0;
        right: 0;
        background-color: white;
        border-radius: 6px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        border: 1px solid #dee2e6;
        display: none;
      }

      .filter-menu.show {
        display: block;
      }

      .filter-option {
        padding: 10px 15px;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .filter-option:hover {
        background-color: #f8f9fa;
      }

      .filter-option.active {
        background-color: #e9ecef;
        color: #007bff;
      }

      .active-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
      }

      .active-filter {
        display: inline-flex;
        align-items: center;
        padding: 4px 12px;
        background-color: #e7f3ff;
        color: #007bff;
        border-radius: 20px;
        font-size: 0.9em;
      }

      .active-filter button {
        background: none;
        border: none;
        color: #007bff;
        margin-left: 8px;
        padding: 0;
        cursor: pointer;
        font-size: 14px;
      }

      #jobSearch {
        height: 45px;
        border-radius: 6px;
        padding: 0 15px;
        border: 1px solid #dee2e6;
      }

      /* #jobSearch {
        width: 100%;
        border-radius: 4px;
        border: 1px solid #ccc;
        padding: 10px;
        box-shadow: none;
        margin-bottom: 20px;
      } */

      /* Updated compact styles for parent info and children sections */
      .parent-info {
        margin-bottom: 8px;
      }

      .parent-info h5 {
        font-size: 1rem;
        margin-bottom: 6px;
      }

      .parent-info p {
        font-size: 0.9rem;
        margin-bottom: 8px;
        line-height: 1.4;
      }

      /* Job Description styles to match other sections */
      #jobDescription h5 {
        font-size: 1rem;
        margin-bottom: 6px;
      }

      #jobDescription p {
        font-size: 0.9rem;
        margin-bottom: 8px;
        line-height: 1.4;
      }

      #jobDescription h5:not(:first-child) {
        margin-top: 12px;
      }

      #jobDescription p:last-child {
        margin-bottom: 12px;
      }

      .children-section {
        margin: 12px 0;
      }

      .children-title {
        font-size: 1rem;
        font-weight: 500;
        margin-bottom: 8px;
        color: #212529;
      }

      .children-container {
        display: flex;
        gap: 8px;
        justify-content: flex-start;
      }

      .child-card {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 6px;
        padding: 8px 12px;
        flex: 1;
        min-width: 0;
      }

      .child-name {
        font-size: 0.9rem;
        font-weight: 500;
        color: #212529;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .child-age {
        color: #6c757d;
        font-size: 0.8rem;
      }

      .profile-header {
        display: flex;
        align-items: flex-start;
        margin-bottom: 30px;
        padding: 20px 0;
        width: 100%;
        gap: 20px;
      }

      .profile-header img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0;
      }

      .profile-info-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        flex: 1;
      }

      .profile-info {
        display: flex;
        flex-direction: column;
      }

      .profile-info h4 {
        font-size: 2.2rem;
        font-weight: 600;
        margin-bottom: 4px;
        color: #333;
      }

      .profile-subtext {
        color: #666;
        font-size: 1.1rem;
        margin-top: 2px;
      }

      .chat-button-container {
        margin-left: auto;
      }

      .chat-button {
        padding: 12px 30px;
        font-size: 1.2rem;
        background-color: #f0f0f0;
        color: #333;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        white-space: nowrap;
      }

      .chat-button:hover {
        background-color: #e0e0e0;
      }

      .chat-button:disabled {
        background-color: #f0f0f0;
        color: #999;
        cursor: not-allowed;
      }

      #detailsContainer {
        background-color: white;
        border: 1px solid #eee;
        border-radius: 12px;
        padding: 20px 30px;
        height: calc(100vh - 60px);
        overflow-y: auto;
        font-family: "Poppins", sans-serif;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
      .info-and-chat-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
        margin-bottom: 20px;
      }

      .parent-info {
        flex: 1;
        margin-bottom: 0; /* Override existing margin */
      }

      .chat-button-container {
        flex-shrink: 0;
        margin: 0; /* Override existing margin */
      }

      .chat-button {
        white-space: nowrap;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAyWvgXsZY9SAUG2voyScZejgbHaKIztZA"></script>
  </head>
  <body>
    <div id="navbar"></div>

    <div class="container mt-3">
      <div class="search-container">
        <div class="search-bar">
          <div class="search-input-group">
            <input
              type="text"
              id="jobSearch"
              class="form-control"
              placeholder="Search posts..."
              onkeyup="searchJobs()"
            />
          </div>

          <div class="filter-dropdown">
            <button id="locationFilter" class="filter-button">
              Location
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="filter-menu" id="locationMenu">
              <!-- Will figure out how to filter based on East, West, Central etc. -->
            </div>
          </div>

          <div class="filter-dropdown">
            <button id="dateFilter" class="filter-button">
              Date
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="filter-menu" id="dateMenu">
              <div class="filter-option" data-value="today">Today</div>
              <div class="filter-option" data-value="tomorrow">Tomorrow</div>
              <div class="filter-option" data-value="this-week">This Week</div>
              <div class="filter-option" data-value="next-week">Next Week</div>
            </div>
          </div>

          <div class="filter-dropdown">
            <button id="payFilter" class="filter-button">
              Pay Range
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="filter-menu" id="payMenu">
              <div class="filter-option" data-value="0-15">$0-15/hr</div>
              <div class="filter-option" data-value="15-25">$15-25/hr</div>
              <div class="filter-option" data-value="25-35">$25-35/hr</div>
              <div class="filter-option" data-value="35+">$35+/hr</div>
            </div>
          </div>
        </div>
        <div class="active-filters" id="activeFilters"></div>
      </div>
    </div>

    <div class="container mt-4">
      <div class="row">
        <!-- Job Cards Section -->
        <div class="col-md-6">
          <div class="list-group">
            <!-- Job cards will be dynamically inserted here -->
          </div>
        </div>

        <!-- Job Details Section -->
        <div class="col-md-6" id="detailsContainer">
          <div class="profile-header">
            <img
              id="profilePicture"
              src="/api/placeholder/80/80"
              alt="Profile Picture"
            />
            <div class="profile-info-wrapper">
              <div class="profile-info">
                <h4 id="nannyName">Select a post to view details</h4>
                <span id="profileSubtext" class="profile-subtext"></span>
              </div>
              <div class="chat-button-container">
                <button id="chatButton" class="chat-button" disabled>
                  Chat Now
                </button>
              </div>
            </div>
          </div>

          <div class="parent-info" id="jobDetails">
            <!-- Parent details will be inserted here -->
          </div>

          <div id="jobDescriptionContainer">
            <div id="jobDescription">
              <!-- Job description and about me will be inserted here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- API KEY -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5BjPBxo5PwTs6N2PAT0YCUvT66CIQuxw&libraries=places"></script>

    <!-- Scripts -->
    <script type="module">
      import { auth, db } from "./backend/firebase-config.js";
      import {
        collection,
        getDocs,
        doc,
        getDoc,
        addDoc,
        serverTimestamp,
      } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

      // Filter state
      let activeFilters = {
        location: null,
        date: null,
        pay: null,
      };

      // Store all posts for filtering
      let allPosts = [];

      // Initialise filters
      function initializeFilters() {
        const filterButtons = document.querySelectorAll(".filter-button");
        const filterOptions = document.querySelectorAll(".filter-option");

        // Handle filter button clicks
        filterButtons.forEach((button) => {
          button.addEventListener("click", (e) => {
            const menu = e.currentTarget.nextElementSibling;
            const isShown = menu.classList.contains("show");

            // Hide all menus first
            document.querySelectorAll(".filter-menu").forEach((m) => {
              m.classList.remove("show");
            });

            // Toggle current menu
            if (!isShown) {
              menu.classList.add("show");
            }
          });
        });

        // Handle filter option selection
        filterOptions.forEach((option) => {
          option.addEventListener("click", (e) => {
            const value = e.target.dataset.value;
            const filterType = e.target
              .closest(".filter-menu")
              .previousElementSibling.id.replace("Filter", "");

            // Update active filters
            activeFilters[filterType] = value;

            // Update UI
            updateActiveFiltersUI();

            // Apply filters
            applyFilters();

            // Hide menu
            e.target.closest(".filter-menu").classList.remove("show");
          });
        });

        // Close menus when clicking outside
        document.addEventListener("click", (e) => {
          if (!e.target.closest(".filter-dropdown")) {
            document.querySelectorAll(".filter-menu").forEach((menu) => {
              menu.classList.remove("show");
            });
          }
        });

        // Initialize search functionality
        document.getElementById("jobSearch").addEventListener("input", (e) => {
          applyFilters();
        });
      }

      // Update active filters UI
      function updateActiveFiltersUI() {
        const container = document.getElementById("activeFilters");
        container.innerHTML = "";

        Object.entries(activeFilters).forEach(([type, value]) => {
          if (value) {
            const filter = document.createElement("div");
            filter.className = "active-filter";
            filter.innerHTML = `
              ${type}: ${value}
              <button onclick="removeFilter('${type}')">×</button>
            `;
            container.appendChild(filter);
          }
        });
      }

      // Remove filter
      window.removeFilter = function (type) {
        activeFilters[type] = null;
        updateActiveFiltersUI();
        applyFilters();
      };

      // Apply filters to posts
      function applyFilters() {
        const searchQuery = document
          .getElementById("jobSearch")
          .value.toLowerCase();

        const filteredPosts = allPosts.filter((post) => {
          // Search text filter
          const matchesSearch =
            post.parentData.firstName.toLowerCase().includes(searchQuery) ||
            post.parentData.lastName.toLowerCase().includes(searchQuery) ||
            post.postData.description.toLowerCase().includes(searchQuery);

          // Location filter
          const matchesLocation =
            !activeFilters.location ||
            post.parentDetails.homeAddress.includes(activeFilters.location);

          // Date filter
          const matchesDate =
            !activeFilters.date ||
            checkDateMatch(post.postData.date.toDate(), activeFilters.date);

          // Pay filter
          const matchesPay =
            !activeFilters.pay ||
            checkPayMatch(post.postData.pay, activeFilters.pay);

          return matchesSearch && matchesLocation && matchesDate && matchesPay;
        });

        displayFilteredPosts(filteredPosts);
      }

      // Helper function to check date matches
      function checkDateMatch(postDate, filterValue) {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);

        switch (filterValue) {
          case "today":
            return isSameDay(postDate, today);
          case "tomorrow":
            return isSameDay(postDate, tomorrow);
          case "this-week":
            return isThisWeek(postDate);
          case "next-week":
            return isNextWeek(postDate);
          default:
            return true;
        }
      }

      // Helper function to check pay range matches
      function checkPayMatch(postPay, filterValue) {
        const [min, max] = filterValue.split("-").map(Number);
        if (filterValue === "35+") {
          return postPay >= 35;
        }
        return postPay >= min && postPay <= max;
      }

      // Helper date functions
      function isSameDay(d1, d2) {
        return (
          d1.getDate() === d2.getDate() &&
          d1.getMonth() === d2.getMonth() &&
          d1.getFullYear() === d2.getFullYear()
        );
      }

      function isThisWeek(date) {
        const today = new Date();
        const weekEnd = new Date(today);
        weekEnd.setDate(today.getDate() + (6 - today.getDay()));
        return date >= today && date <= weekEnd;
      }

      function isNextWeek(date) {
        const today = new Date();
        const nextWeekStart = new Date(today);
        nextWeekStart.setDate(today.getDate() + (7 - today.getDay()));
        const nextWeekEnd = new Date(nextWeekStart);
        nextWeekEnd.setDate(nextWeekStart.getDate() + 6);
        return date >= nextWeekStart && date <= nextWeekEnd;
      }

      // Display filtered posts
      function displayFilteredPosts(posts) {
        const jobListContainer = document.querySelector(".list-group");
        jobListContainer.innerHTML = "";

        posts.forEach(({ postData, parentData }) => {
          const jobCard = document.createElement("div");
          jobCard.className = "list-group-item job-card";
          jobCard.onclick = () => showDetails(postData.userId, postDoc.id);

          jobCard.innerHTML = `
            <div class="job-card-content">
              <img src="${
                parentData.profilePictureUrl || "/api/placeholder/60/60"
              }" alt="Profile" />
              <div class="job-description">
                <h5>${parentData.firstName} ${parentData.lastName}</h5>
                <p>Time of Job: ${postData.startTime} - ${postData.endTime}<br>
                  Expected Pay: $${postData.pay}/hr<br>
                  Pay Negotiable: ${postData.payNegotiation ? "Yes" : "No"}<br>
                  Date of Job: ${new Date(
                    postData.date
                  ).toLocaleDateString()}</p>
              </div>
            </div>
          `;

          jobListContainer.appendChild(jobCard);
        });

        // If there are filtered posts, show details of the first one
        if (posts.length > 0) {
          showDetails(posts[0].postData.userId, posts[0].postDoc.id);
        }
      }

      // Function to calculate age from DOB
      function calculateAge(dob, gender) {
        const birthDate = new Date(dob);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        if (
          monthDiff < 0 ||
          (monthDiff === 0 && today.getDate() < birthDate.getDate())
        ) {
          age--;
        }
        gender = gender.charAt(0).toUpperCase() + gender.slice(1);

        return { age, gender };
      }

      // Function to initialize chat button
      function initializeChatButton(currentUserId, parentId) {
        const chatButton = document.getElementById("chatButton");

        if (currentUserId) {
          chatButton.disabled = false;

          chatButton.addEventListener("click", async () => {
            try {
              const chatData = {
                to_user_id: parentId,
                from_user_id: auth.currentUser.uid,
                timestamp: new Date(),
                message:
                  "Hi, I'm interested in your job posting and would like to discuss details.",
              };

              await addDoc(collection(db, "CHATS"), chatData);
              alert("Message sent successfully!");
            } catch (error) {
              console.error("Error sending message:", error);
              alert("Failed to send message. Please try again.");
            }
          });
        } else {
          chatButton.disabled = true;
        }
      }

      // Function to load all posts
      async function loadPosts() {
        try {
          const postsSnapshot = await getDocs(collection(db, "POSTS"));
          const jobListContainer = document.querySelector(".list-group");
          jobListContainer.innerHTML = "";

          allPosts = [];

          for (const postDoc of postsSnapshot.docs) {
            const postData = postDoc.data();
            const userId = postData.userId;

            const parentDoc = await getDoc(doc(db, "USER", userId));
            const parentData = parentDoc.exists() ? parentDoc.data() : null;

            const parentDetailsDoc = await getDoc(doc(db, "PARENT", userId));
            const parentDetails = parentDetailsDoc.exists()
              ? parentDetailsDoc.data()
              : null;

            if (parentData && parentData.role === "parent" && parentDetails) {
              allPosts.push({
                postDoc,
                postData,
                parentData,
                parentDetails,
              });
            }
          }

          allPosts.sort((a, b) => {
            // Directly convert the date string to a Date object
            const dateA = new Date(a.postData.date);
            const dateB = new Date(b.postData.date);

            return dateA - dateB;
          });

          // Initialize filters after loading posts
          initializeFilters();

          // Display all posts initially
          displayFilteredPosts(allPosts);

          // Populate location filter with unique locations
          const locations = [
            ...new Set(
              allPosts.map((post) =>
                post.parentDetails.homeAddress.split(",")[1].trim()
              )
            ),
          ];

          const locationMenu = document.getElementById("locationMenu");
          locations.forEach((location) => {
            const option = document.createElement("div");
            option.className = "filter-option";
            option.dataset.value = location;
            option.textContent = location;
            locationMenu.appendChild(option);
          });
        } catch (error) {
          console.error("Error loading posts:", error);
        }
      }

      // Load posts when the page loads
      document.addEventListener("DOMContentLoaded", () => {
        loadPosts();
      });

      // Function to show details when a card is clicked
      async function showDetails(userId, postId) {
        try {
          const parentDoc = await getDoc(doc(db, "USER", userId));
          const parentData = parentDoc.exists() ? parentDoc.data() : null;

          const postDoc = await getDoc(doc(db, "POSTS", postId));
          const postData = postDoc.exists() ? postDoc.data() : null;

          const parentDetailsDoc = await getDoc(doc(db, "PARENT", userId));
          const parentDetails = parentDetailsDoc.exists()
            ? parentDetailsDoc.data()
            : null;

          if (parentData && postData && parentDetails) {
            // Update profile picture and name
            document.getElementById("profilePicture").src =
              parentData.profilePictureUrl || "/api/placeholder/80/80";
            document.getElementById(
              "nannyName"
            ).innerHTML = `${parentData.firstName} ${parentData.lastName}`;
            const { age, gender } = calculateAge(
              parentData.dob,
              parentData.gender
            );
            document.getElementById(
              "profileSubtext"
            ).innerHTML = `${gender} | ${age} years old`;

            // Update parent details
            let detailsHTML = `<h5>About:</h5>
        <p>${parentDetails.aboutMe || "No information provided"}</p>`;

            // Add children information
            if (parentDetails.children && parentDetails.children.length > 0) {
              detailsHTML += `
          <div class="children-section">
            <div class="children-title">Children:</div>
            <div class="children-container">
              ${parentDetails.children
                .map(
                  (child, index) => `
                <div class="child-card">
                  <div class="child-name">${child.name}</div>
                  <div class="child-age">${child.age} years old</div>
                </div>
              `
                )
                .join("")}
            </div>
          </div>
        `;
            }

            document.getElementById("jobDetails").innerHTML = detailsHTML;

            // Update description section
            let descriptionHTML = `
        <h5>Job Description:</h5>
        <p>${postData.description}</p>
      `;

            document.getElementById("jobDescription").innerHTML =
              descriptionHTML;

            // Initialize chat button
            initializeChatButton(auth.currentUser?.uid, userId);

            // Google Maps API
            const address = parentDetails.homeAddress;
            geocodeAddress(address);
          }
        } catch (error) {
          console.error("Error showing details:", error);
        }
      }

      // Geocoding API
      function geocodeAddress(address) {
        const geocoder = new google.maps.Geocoder();
        geocoder.geocode({ address: address }, (results, status) => {
          if (status === "OK") {
            const location = results[0].geometry.location;

            const approxCityOrNeighbourhood =
              results[0].address_components.find(
                (component) =>
                  component.types.includes("neighborhood") ||
                  component.types.includes("locality")
              )?.long_name || "Location unavailable";

            document.getElementById("jobDescription").innerHTML += `
        <h5>Approximate Location:</h5>
        <p>${approxCityOrNeighbourhood}</p>
        <div id="map" style="height: 300px;"></div>
      `;

            initialiseMap(location);
          } else {
            console.error("Geocode was not successful:", status);
          }
        });
      }

      // Initialize Google Map and place a marker
      function initialiseMap(location) {
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 14,
          center: location,
        });

        new google.maps.Marker({
          position: location,
          map: map,
        });
      }

      // Function to handle search
      window.searchJobs = function () {
        const input = document.getElementById("jobSearch");
        const filter = input.value.toLowerCase();
        const jobCards = document.querySelectorAll(".job-card");

        jobCards.forEach((card) => {
          const title = card.querySelector("h5").textContent.toLowerCase();
          const details = card
            .querySelector(".job-description")
            .textContent.toLowerCase();
          if (title.includes(filter) || details.includes(filter)) {
            card.style.display = "";
          } else {
            card.style.display = "none";
          }
        });
      };

      // Auth state listener
      auth.onAuthStateChanged((user) => {
        const chatButton = document.getElementById("chatButton");
        if (user) {
          chatButton.disabled = false;
        } else {
          chatButton.disabled = true;
        }
      });

      // Load posts when the page loads
      document.addEventListener("DOMContentLoaded", () => {
        loadPosts();
      });
    </script>

    <script type="module">
      import { auth, db } from "./backend/firebase-config.js";
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
      import {
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
      import { logout } from "./backend/auth.js";

      async function loadNavbar(user) {
        let fileToLoad = "unloggedin_navbar_template.html";

        if (user) {
          try {
            const userDoc = await getDoc(doc(db, "USER", user.uid));
            if (userDoc.exists()) {
              const userData = userDoc.data();
              if (userData.role === "parent") {
                fileToLoad = "parent_navbar_template.html";
              } else if (userData.role === "nanny") {
                fileToLoad = "nanny_navbar_template.html";
              }
            }
          } catch (error) {
            console.error("Error fetching user role:", error);
          }
        }

        try {
          const response = await fetch(fileToLoad);
          if (!response.ok) throw new Error("Network response was not ok");

          const navbarHTML = await response.text();
          document.getElementById("navbar").innerHTML = navbarHTML;

          const logoutLink = document.querySelector("#logoutBtn");
          if (logoutLink) {
            logoutLink.addEventListener("click", async (e) => {
              e.preventDefault();
              try {
                await logout();
              } catch (error) {
                console.error("Logout failed:", error);
              }
            });
          }
        } catch (error) {
          console.error("Failed to load navbar:", error);
        }
      }

      onAuthStateChanged(auth, (user) => {
        loadNavbar(user);
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
